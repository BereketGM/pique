{"tagline":"A efficient peak finder for high coverage ChIP-seq experiments.","body":"The pique package is an efficiency peak finder for ChIP-seq\r\nexperiments that yield high coverage allignments to the reference\r\ngenome. It was developed for studying gene expression in Halobacterium\r\nsalinarum sp. NRC1, sequenced using barcoded 40bp Illumina reads as\r\npart of an ongoing project in Marc Facciotti's lab at UC Davis.\r\n\r\n![A peek at peaks in Pique.](https://github.com/ryneches/pique/raw/master/docs/peak_example_2.png)\r\n\r\n## Author & Contact Information\r\n\r\nPique was written by Russell Neches, a graduate student in Jonathan\r\nEisen's laboratory. \r\n\r\n* Russell's Blog    : [http://vort.org/](http://vort.org)\r\n* Russell's Twitter : [@ryneches](https://twitter.com/ryneches)\r\n* Russell's Email   : ryneches at ucdavis dot edu\r\n* Lab homepage      : [http://phylogenomics.wordpress.com/](http://phylogenomics.wordpress.com/)\r\n\r\n## Installation\r\n\r\nDo the usual python thing.\r\n\r\n    $ cd pique\r\n    $ python setup.py install --prefix=/someplace/PYTHONPATH/knows/about\r\n\r\n\r\n## Tests\r\n\r\nTests are designed to be used with nose. \r\n\r\n    http://somethingaboutorange.com/mrl/projects/nose/\r\n\r\nThe tests (stupidly) depend on hard-coded paths to find the test data\r\nfiles, so you have to run nosetests from the main module directory\r\n(i.e., the one that has setup.py in it).\r\n\r\n    $ cd pique\r\n    $ nosetests\r\n\r\n## Dependencies\r\n\r\nThis package requires the following packages :\r\n\r\n*     scipy\r\n*     numpy\r\n*     pysam\r\n*     cython\r\n*     matplotlib\r\n        \r\nSuggested :\r\n\r\n*     ipython\r\n*     samtools\r\n*     Gaggle Genome Browser\r\n\r\n## Usage\r\n\r\nThis software can be used either as a stand-alone application, or as a\r\nlibrary accessed by your own software.\r\n\r\nTo use pique as a stand-alone application, there is a self-documenting\r\ncommand line interface :\r\n\r\n    $ ./pique -h\r\n    usage: pique [-h] {batch,tk,mapmaker} ...\r\n    \r\n    Pique, a ChIP-seq analytical tool.\r\n    \r\n    optional arguments:\r\n      -h, --help           show this help message and exit\r\n    \r\n    commands:\r\n    {batch,tk,mapmaker}\r\n      batch              command-line mode for peak detection\r\n      tk                 GUI mode for peak detection\r\n      mapmaker           genome analysis region mapping utility\r\n\r\nThe application has three modes, batch, tk, and mapmaker. To access\r\nthe GUI interface, run :\r\n\r\n    $ pique tk\r\n\r\n![The Pique Tk GUI.](https://github.com/ryneches/pique/raw/master/docs/Pique_GUI.png)\r\n\r\nThe application window will appear. Enter a name for your project in\r\nthe 'Project name' field; this will be the name prefix for the output\r\nfiles. Choose files for the IP and BG (background) tracks; these\r\nshould be indexed BAM files, created by mapping your IP and control\r\nreads to the reference sequence. Many different tools can be used for\r\nthis, such as bowtie, bwa and SHRiMP.\r\n\r\nThe IP and background BAM files must contain identical contig names.\r\n\r\nIf desired, choose a genome map file ('Map (optional)'). See below for\r\nhow to create one.\r\n\r\nEnter the dominant fragment length of the sequencing library, and the\r\nread length used for the sequencing run. If you have performed quality\r\ntrimming, you may wish to use the average or median read length after\r\ntrimming for the read length.\r\n\r\nThen, click 'Run.' Your BAM files will be loaded and processed, and\r\noutput files will be written in the directory from which pique.py was\r\ninvoked. Run time for a bacterial genome depends on the number of\r\nmapped reads and the length of the genome. For our projects, we have\r\nfound that a run takes about one to five minutes.\r\n\r\n## Batch Mode\r\n\r\nIf you have many experiments to process, it may be more convenient to\r\nrun pique from a script. \r\n\r\n    $ pique batch -h\r\n    usage: pique batch [-h] -name NAME -ip IPFILE -bg BGFILE -map MAPFILE\r\n                       [-a ALPHA] [-l L_THRESH] [-p]\r\n\r\n    optional arguments:\r\n      -h, --help    show this help message and exit\r\n      -name NAME    project name\r\n      -ip IPFILE    BAM file for IP data\r\n      -bg BGFILE    BAM file for control data\r\n      -map MAPFILE  genome map file\r\n      -a ALPHA      read length\r\n      -l L_THRESH   expected binding footprint\r\n      -p            make a pickel file\r\n\r\nThe arguments are essentially the same as those found in the GUI,\r\nexcept for the option of making a pickle file. If this option is\r\nenabled, after completing the anaysis, pique will dump the entire\r\nanalysis workbench object into a pickle file. This can be very useful\r\nfor debugging and data post-processing in Python. For example, the\r\npickle file can be used to load the analysis workbench into an\r\ninteractive ipython session and used to generate figures.\r\n\r\n    http://docs.python.org/2/library/pickle.html\r\n\r\n## Mapmaker Mode\r\n\r\n    $ pique mapmaker -h\r\n    usage: pique mapmaker [-h] -name NAME -bamfile BAMFILE [-window\r\n    WINDOW]\r\n                          [-stride STRIDE] -highest HIGHEST -lowest LOWEST\r\n                          [-bins BINS]\r\n\r\n    optional arguments:\r\n      -h, --help        show this help message and exit\r\n      -name NAME        project name\r\n      -bamfile BAMFILE  BAM file of aligned data\r\n      -window WINDOW    sliding window size\r\n      -stride STRIDE    stride length\r\n      -highest HIGHEST  highest histogram bin\r\n      -lowest LOWEST    lowest histogram bin\r\n      -bins BINS        number of histogram bins\r\n\r\n\r\n## Genome Map File\r\n\r\nThe Genome Map File is a GFF-formatted file describing three kinds of\r\nfeatures; analysis regions, masking regions, and normalization\r\nregions. Analysis and masking region annotations are optional;\r\nhowever, each analysis region MUST have at least one normalization\r\nregion. (Note : If you do not describe any analysis regions, one will\r\nautomatically be created spanning each contig. So, if you do not\r\ndescribe any analysis regions for a contig, you must still describe at\r\nleast one normalization region for that contig.)\r\n\r\nAnalysis regions should use the feature name 'analysis_region' in the\r\nfile, and describe sub-regions of the contig that you wish to process\r\nindependently. For example, if there are inconsistencies in coverage\r\nlevel due to gene dosage variations with respect to the reference,\r\nprocessing the dosage regions separately can improve peak detection.\r\n\r\nMasking regions should use the feature name 'mask' in the file, and\r\ndescribe sub-regions of the analysis regions that you wish to delete\r\nfrom the analysis. (Note: Masking regions *must* fall completely\r\nwithin an analysis region.) This is useful for hiding coverage\r\naberrations due to repetitive regions, such as IS elements.\r\n\r\nBy default, an analysis region describing the whole contig is created\r\nfor each contig. When an analysis region is loaded by the user via the\r\nmapping file, the default analysis region for that contig is deleted. \r\n\r\nNormalization regions should use the name 'norm_region' in the map\r\nfile, and describe regions (within analysis regions) in which there\r\nare thought to be no binding events. These regions will be used to\r\ncalibrate the sequencing coverage between the IP track and the control\r\ntrack. If the user chooses poor normalization regions, Pique will\r\nstill function, but will produce incorrect normalization factors and\r\nmay set the peak detection cutoff too stringently.\r\n\r\nFeatures described in the genome map file must use the same contig\r\nnames as the IP and background BAM files. To see them, run :\r\n\r\n    $ samtools view -H BAMfile.bam\r\n\r\nMost columns in the GFF file are unused, and may be left empty (as\r\nlong as the correct number of tabs are present). The required fields\r\nare :\r\n\r\n    0   contig name\r\n    2   'analysis_region', 'mask' or 'norm_region'\r\n    3   start coordinate\r\n    4   end coordinate\r\n\r\nAn example genome map file is provided (data/map.gff).\r\n\r\n## Output Files\r\n\r\n    <name>.IP.track  : A GGB-formatted track file of the IP data\r\n    <name>.BG.track  : A GGB-formatted track file of the BG data\r\n    <name>.bookmark  : A list of GGB bookmarks for each peak\r\n    <name>.qp        : GGB-formatted quantitative positional data \r\n                       of binding coordinates\r\n    <name>.gff       : A GFF file of each peak\r\n    <name>.peak.tsv  : Peak statistical quantities in TSV format\r\n\r\nThe GFF output file includes the following columns :\r\n\r\n    0   contig name\r\n    1   software version\r\n    2   feature description\r\n    3   start coordinate\r\n    4   end coordinate\r\n    5   enrichment ratio relative to background\r\n\r\nThe TSV output includes the following columns :\r\n\r\n    0   contig\r\n    1   start\r\n    2   stop\r\n    3   binds_at            # binding coordinate\r\n    4   enrichment_ratio    \r\n    5   average_contig_norm # mean of all norms\r\n    6   std_contig_norm     # standard deviation of all norms\r\n    7..                     # all subsequent colunms are the norms\r\n\r\nThe bookmark file contains some additional annotations in addition to\r\nthe required GGB bookmark information :\r\n\r\n    binds_at            estimated binding coordinate\r\n    enrichment_ratio    enrichment ratio relative to background\r\n    norm_0, norm_1...   the normalization factors calculated from the\r\n                        normilization regions\r\n\r\n## Caveats\r\n\r\nBinding coordinates : The peak calling step (pique.py) will attempt to\r\ncalculate a binding coordinate for the putative peaks it finds. The\r\nmethod used is extremely naive, but we find that it generally comes\r\nwithin about 5bp of the expected binding site.\r\n\r\nDouble peaks : Some enriched regions contain two binding sites, but\r\nthe algorithm is unable to de-convolute them. We have tried running\r\nthese regions through several other peak callers with little success.\r\nWe have included a script for identifying sites that are likely to be\r\ndouble peaks to assist with curation.\r\n\r\n## Downstream Analysis\r\n\r\nPique does not attempt to filter peaks that are statistically\r\ninsignificant. We have found that this part of the analysis is rather\r\nspecific to the data and to the experiment. \r\n\r\nTo address this, Pique is designed to achieve a low false-negative\r\nrate at the cost of a potentially high false-positive rate (it appears\r\nthat the false-positive rate is in practice rather low compared to\r\nother software, but we have not implemented any filtering to prevent\r\nthem from happening). The idea is that it is painstaking work to find\r\na putative peak, it is less difficult to discard unsatisfactory peaks\r\nonce they have been found.  Thus, some kind of post-filtering is\r\nnecessary. Pique provides the user with output that can be used to\r\nsupport a variety of such statistical tests.\r\n\r\nSome recommended filtering might include :\r\n\r\n1. Eliminate peaks that are significantly narrower than the size range of the sequencing library, and perhaps other peaks that cluster with them.\r\n2. Eliminate peaks with a normalized enrichment ratio below 1.0, or peaks that cluster with them.\r\n3. Eliminate peaks that have predicted binding sites that are very skewed from the center of the enriched region.\r\n\r\nDepending on how many peaks are recovered, the user may wish to try\r\none or all of these, perhaps with clustering to avoid arbitrary\r\ncutoffs.\r\n\r\nHowever, we do not recommend trying to generate a \"perfect\" peak list\r\nby statistical analysis alone.\r\n\r\n## Manual Curation\r\n\r\nMicrobial genomes are fairly small. It is probably not worth the\r\neffort to undertake a very complicated statistical effort to eliminate\r\nall false positives. We recommend applying a few basic statistical\r\ntests, and then loading tracks, quantitative positionals and bookmarks\r\ninto the Gaggle Genome Browser.\r\n\r\nOnce the data is loaded into the browser, view the bookmark list. When\r\nyou select a bookmark, the browser will automatically scan to that\r\nregion of the genome and highlight the putative peak region. If you\r\nthink the peak is a false positive, press the delete key.\r\n\r\nWhen you are finished, save a copy of the bookmark file. We find that\r\ncuration of a microbial genome in this way takes about ten to twenty\r\nminutes.\r\n\r\n## Inspirational Quote\r\n\r\nI met men at every turn who owned from one thousand to thirty thousand\r\n\"feet\" in undeveloped silver mines, every single foot of which they\r\nbelieved would shortly be worth from fifty to a thousand dollars—and\r\nas often as any other way they were men who had not twenty-five\r\ndollars in the world. Every man you met had his new mine to boast of,\r\nand his \"specimens\" ready; and if the opportunity offered, he would\r\ninfallibly back you into a corner and offer as a favor to you, not to\r\nhim, to part with just a few feet in the \"Golden Age,\" or the \"Sarah\r\nJane,\" or some other unknown stack of croppings, for money enough to\r\nget a \"square meal\" with, as the phrase went. And you were never to\r\nreveal that he had made you the offer at such a ruinous price, for it\r\nwas only out of friendship for you that he was willing to make the\r\nsacrifice. Then he would fish a piece of rock out of his pocket, and\r\nafter looking mysteriously around as if he feared he might be waylaid\r\nand robbed if caught with such wealth in his possession, he would dab\r\nthe rock against his tongue, clap an eyeglass to it, and exclaim:\r\n\r\n\"Look at that! Right there in that red dirt! See it? See the specks of\r\ngold? And the streak of silver? That's from the Uncle Abe. There's a\r\nhundred thousand tons like that in sight! Right in sight, mind you!\r\nAnd when we get down on it and the ledge comes in solid, it will be\r\nthe richest thing in the world! Look at the assay! I don't want you to\r\nbelieve me—look at the assay!\"\r\n\r\nThen he would get out a greasy sheet of paper which showed that the\r\nportion of rock assayed had given evidence of containing silver and\r\ngold in the proportion of so many hundreds or thousands of dollars to\r\nthe ton.\r\n\r\nI little knew, then, that the custom was to hunt out the richest piece\r\nof rock and get it assayed! Very often, that piece, the size of a\r\nfilbert, was the only fragment in a ton that had a particle of metal\r\nin it—and yet the assay made it pretend to represent the average value\r\nof the ton of rubbish it came from!\r\n\r\n- Mark Twain, Roughing It\r\n\r\n\r\n## Legal Stuff\r\n\r\nCopyright (c) 2012, Russell Neches\r\nAll rights reserved.\r\n\r\nRedistribution and use in source and binary forms, with or without\r\nmodification, are permitted provided that the following conditions are\r\nmet:\r\n\r\n* Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.\r\n* Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.\r\n* Neither the name of the University of California, Davis nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.\r\n\r\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\r\n\"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\r\nLIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\r\nA PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\r\nHOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\r\nSPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\r\nLIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\r\nDATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\r\nTHEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\r\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\r\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration.","name":"Pique"}